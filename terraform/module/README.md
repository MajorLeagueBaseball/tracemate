## module

Contains the circonus visuals and circonus rulesets for a team

A user of this module defines the API key for their account, plus the set of
service names, and URL's for which to generate visuals. They can also define the
set of things and thresholds to create SLO based rulesets and visuals about.

To use this module:

```
module "circonus" {

  source           = "../module"
  circonus_api_key = var.circonus_api_key
  team_name        = "myteam"
  
  sre = {
    sev1 = []
    sev2 = ["/contact_group/12345"]
    sev3 = []
    sev4 = []
    sev5 = []
  }

  top-level-services = {
    "myteam-myservice-myenvironment" = {
      name    = "myteam-myservice-myenvironment"
      type    = "transactional"
      runtime = "nodejs"
      
      sre = {
        memory_alert_threshold = null
        memory_alert_severity  = null
        override               = null

        latency = {
          description         = "The service will respond to 99% of requests in at or under 1000ms.  Error budget covers 4 weeks."
          window_threshold_ms = 1000
          url_base            = "myteam"
          window_percentile   = 99
          budget_duration     = "4w"
          budget_timezone     = "US/Eastern"
          severity            = 2
        }
        
        errors = null
      }
    },
  }
  urls = [
  ]
  apm_check_uuid = "<some check uuid>"
  apm_check_cid = "<some check bundle cid>"
}

```

### Variables

* `circonus_api_key` - (string) The `admin` privileged API key at circonus which
  can be used to create various resources
* `team_name` - (string) The short name of the team (the prefix of the
  `elastic.apm.service_name`)
* `sre` - (object) Lists contact group CIDs where various alerts should be sent
  depending on severity
  * `sev1` - list(string) contain the contact group CID's that should receive
    severity level 1 alerts.
  * `sev2` - list(string) contain the contact group CID's that should receive
    severity level 2 alerts.
  * `sev3` - list(string) contain the contact group CID's that should receive
    severity level 3 alerts.
  * `sev4` - list(string) contain the contact group CID's that should receive
    severity level 4 alerts.
  * `sev5` - list(string) contain the contact group CID's that should receive
    severity level 5 alerts.
* `top-level-services` - a `map(object)` which contains each service you want to
  generate a dashboard and rulesets for
  * `name` - the name of the service (must match the one defined in
    `elastic.apm.service_name` in the elastic apm agent installation)
  * `type` - can be "transactional" or "message". "transactional" means that
    it's a typical REST service, "message" means it's a message processor
  * `runtime` - can be "java" or "nodejs" - determines how the memory graphing
    and alerting is accomplished
  * `sre` - an object which contains SRE settings 
    * `memory_alert_threshold` - (number) the percentage of used memory which
      should generate an alert. Set this to `null` to skip memory alerting.
    * `memory_alert_severity` - (number) the severity (1-5) to send out when an
      alert occurs
    * `override` - (object) a mechanism to allow each service to have different
      alert contact groups than the overall team has. This follows the same
      pattern as the top level `sre` set of `sevN` lists.
    * `latency` - (object) If this service desires SLO visuals (error budgets)
      and alerting set this object, otherwise set to `null`
      * `description` - (string) A plain sentence about the latency SLO, not
        used for anything merely docs.
      * `window_threshold_ms` - (number) The latency threshold.
      * `url_base` - (string) the account specific portion of your circonus url,
        e.g. the `mlb-bdata` in `https://mlb-bdata.circonus.com`
      * `window_percentile` - (number) the percentile for the SLO
      * `budget_duration` - (string) the length of the error budget in a unit
        suffixed string
      * `budget_timezone` - (string) the locale that the budget_duration applies
        to.
      * `severity` - (number) the severity of the alerts generated by error
        budget burn down rate being high.
    * `errors` - (object) If this service desires SLO's surrounding successful
      http response ratio, set this, otherwise leave `null`
      * `description` - (string) A plain sentence about the response SLO, not
        used for anything merely docs.
      * `url_base` - (string) the account specific portion of your circonus url,
        e.g. the `mlb-bdata` in `https://mlb-bdata.circonus.com`
      * `window_percentile` - (number) the percentile for the SLO
      * `budget_duration` - (string) the length of the error budget in a unit
        suffixed string
      * `budget_timezone` - (string) the locale that the budget_duration applies
        to.
      * `severity` - (number) the severity of the alerts generated by error
        budget burn down rate being high.
* `urls` - list(object) A list of URLs per service to generate a worksheet for.
  * `service` - (string) The name of the service as listed in `top-level-services`
  * `url` - (string) the url path to generate a worksheet for, e.g. `/api/v1/foo/{id}`
* `apm_check_uuid` - (string) the UUID of the HTTPTrap check that receives the data for this team from tracemate
* `apm_check_cid` - (string) the CID of the HTTPTrap check that receives the data for this team from tracemate
* `circonus_color_palette` - list(string) the list of color hex codes to use on graph lines in the dashboards.
